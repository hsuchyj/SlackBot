{"version":3,"sources":["../src/middleware/LoadBotChannelData.ts"],"names":[],"mappings":";;;;;;;;;;AACA,oDAAoD;AAGpD,8DAA8D;AAC9D,yFAAyF;AACzF,uDAAuD;AACvD;IAEI,YACY,cAAkC;QAAlC,mBAAc,GAAd,cAAc,CAAoB;QAG9B,eAAU,GAAG,CAAO,OAAwB,EAAE,IAAc,EAAiB,EAAE;YAC3F,IAAI;gBACA,IAAI,IAAI,CAAC,cAAc,EAAE;oBACrB,IAAI,kBAAkB,GAAQ,OAAO,CAAC;oBACtC,IAAI,SAAS,GAAG,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;oBAC1D,IAAI,SAAS,EAAE;wBACX,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,SAAS,EAAG,SAAS,EAAE,CAAC,CAAC;wBACxE,kBAAkB,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,IAAI,EAAG,CAAC;qBAC5D;yBAAM;wBACH,qFAAqF;wBACrF,kBAAkB,CAAC,WAAW,GAAG,OAAO,CAAC,gBAAgB,CAAC;qBAC7D;iBACJ;aACJ;YAAC,OAAO,CAAC,EAAE;gBACR,kBAAkB;aACrB;YACD,IAAI,EAAE,CAAC;QACX,CAAC,CAAA,CAAA;IAnBG,CAAC;CAqBR;AAzBD,gDAyBC","file":"LoadBotChannelData.js","sourcesContent":["import * as builder from \"botbuilder\";\nimport * as DialogUtils from \"../utils/DialogUtils\";\nimport { IBotChannelStorage } from \"../storage/BotChannelStorage\";\n\n// Populates channelData property in session with channel data\n// Channel data is specific to a Microsoft Teams channel for messages in channel context,\n// for 1:1 messages it is the same as conversationData.\nexport class LoadBotChannelData implements builder.IMiddlewareMap {\n\n    constructor(\n        private channelStorage: IBotChannelStorage,\n    ) { }\n\n    public readonly botbuilder = async (session: builder.Session, next: Function): Promise<void> => {\n        try {\n            if (this.channelStorage) {\n                let channelStorageData: any = session;\n                let channelId = DialogUtils.getChannelId(session.message);\n                if (channelId) {\n                    let data = await this.channelStorage.getData({ channelId : channelId });\n                    channelStorageData.channelData = data.channelData || { };\n                } else {\n                    // In conversations not in channel context, the conversation data is the channel data\n                    channelStorageData.channelData = session.conversationData;\n                }\n            }\n        } catch (e) {\n            // console.log(e);\n        }\n        next();\n    }\n\n}\n"],"sourceRoot":"/app/build"}