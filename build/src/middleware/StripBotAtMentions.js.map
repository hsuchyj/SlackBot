{"version":3,"sources":["../src/middleware/StripBotAtMentions.ts"],"names":[],"mappings":";;AAEA,2CAA2C;AAC3C;IAAA;QAEoB,eAAU,GAAG,CAAC,OAAwB,EAAE,IAAc,EAAQ,EAAE;YAC5E,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;YAC9B,IAAI,OAAO,EAAE;gBACT,IAAI,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC;gBAClD,IAAI,aAAa,GAAG,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,CAC3D,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,CAAC,CAAC;gBAC/F,IAAI,aAAa,IAAI,aAAa,CAAC,MAAM,EAAE;oBACvC,gDAAgD;oBAC/C,OAAe,CAAC,mBAAmB,GAAG,OAAO,CAAC,IAAI,CAAC;oBACpD,gDAAgD;oBAChD,OAAO,CAAC,IAAI,GAAG,aAAa,CAAC,MAAM,CAC/B,CAAC,YAAY,EAAE,MAAM,EAAE,EAAE;wBACrB,OAAO,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;oBACxD,CAAC,EACD,OAAO,CAAC,IAAI,CACf,CAAC;iBACL;aACJ;YACD,IAAI,EAAE,CAAC;QACX,CAAC,CAAA;IACL,CAAC;CAAA;AAtBD,gDAsBC","file":"StripBotAtMentions.js","sourcesContent":["import * as builder from \"botbuilder\";\n\n// Strip bot mentions from the message text\nexport class StripBotAtMentions implements builder.IMiddlewareMap {\n\n    public readonly botbuilder = (session: builder.Session, next: Function): void => {\n        let message = session.message;\n        if (message) {\n            let botMri = message.address.bot.id.toLowerCase();\n            let botAtMentions = message.entities && message.entities.filter(\n                (entity) => (entity.type === \"mention\") && (entity.mentioned.id.toLowerCase() === botMri));\n            if (botAtMentions && botAtMentions.length) {\n                // Save original text as property of the message\n                (message as any).textWithBotMentions = message.text;\n                // Remove the text corresponding to each mention\n                message.text = botAtMentions.reduce(\n                    (previousText, entity) => {\n                        return previousText.replace(entity.text, \"\").trim();\n                    },\n                    message.text,\n                );\n            }\n        }\n        next();\n    }\n}\n"],"sourceRoot":"/app/build"}